<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kirim File ke Server</title>
    <link rel="stylesheet" href="style.css" />
    <script src="script.js" defer></script>

    <!-- Favicon / Logo -->
    <link rel="icon" type="image/png" href="https://png.pngtree.com/png-clipart/20230409/original/pngtree-free-delivery-truck-logo-design-png-image_9037662.png" />
</head>

<body>
    <!-- Splash Intro -->
    <div id="splashIntro" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fff;display:flex;justify-content:center;align-items:center;flex-direction: column;z-index:9999; transition: opacity 0.5s ease;">
  <img src="https://png.pngtree.com/png-clipart/20230409/original/pngtree-free-delivery-truck-logo-design-png-image_9037662.png" alt="Logo Intro" style="width:150px; height:150px; object-fit:contain;" />
  <div id="refreshMessage" style="margin-top: 1rem; color: red; font-weight: bold; display: none; text-align: center;">
    Jika halaman tersendat, silakan <button onclick="location.reload()" style="color: blue; text-decoration: underline; background:none; border:none; cursor:pointer; font-weight: normal;">refresh</button> halaman ini.
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const splash = document.getElementById('splashIntro');
    const refreshMsg = document.getElementById('refreshMessage');

    if (sessionStorage.getItem('introShown')) {
      splash.style.display = 'none';
    } else {
      setTimeout(() => {
        splash.classList.add('fade-out');
        splash.style.opacity = '0';

        splash.addEventListener('transitionend', () => {
          splash.style.display = 'none';
        });

        sessionStorage.setItem('introShown', 'true');
      }, 2000);

      // Jika splash masih tampil setelah 5 detik, tampilkan pesan refresh
      setTimeout(() => {
        if (splash.style.display !== 'none') {
          refreshMsg.style.display = 'block';
        }
      }, 5000);
    }
  });
</script>

<style>
  #splashIntro.fade-out {
    opacity: 0;
    transition: opacity 0.5s ease;
  }
</style>

    <div id="app" class="min-h-screen p-6">
        <div class="max-w-5xl mx-auto">
            <header class="header-responsive mb-6">
                <div class="header-slideshow-container">
                    <img src="https://livingnomads.com/wp-content/uploads/2016/12/20/yogjakarta-indonesia-guide.jpg" alt="Gambar1" class="slideshow-image" />
                    <img src="https://i.ytimg.com/vi/b9J1PHFrlaU/maxresdefault.jpg" alt="Gambar  2" class="slideshow-image" />
                    <img src="https://wallpaperaccess.com/full/2043912.jpg" alt="Gambar 3" class="slideshow-image" />
                    <img src="https://4.bp.blogspot.com/-MC1JkSk-XoM/WnqVOpKkUtI/AAAAAAAAC58/WcH7rCUtfM4a_-wIlEFmfzC0Fk9WwVuYwCLcBGAs/s640/Jalan-Malioboro.jpg" alt="Depan" class="slideshow-image" />
                </div>

                <div class="header-content">
                    <img src="https://png.pngtree.com/png-clipart/20230409/original/pngtree-free-delivery-truck-logo-design-png-image_9037662.png" alt="Logo Sekolah" class="w-20 h-20 object-contain rounded-lg shadow-md bg-white p-2" />
                    <div class="text-white">
                        <h1 class="text-3xl font-extrabold text-red-700">Kirim Segala Jenis File Di situs Ini</h1>
                        <p class="text-sm text-gray-200">Yhns 01 Production — Kirim file yang bisa di download disini!</p>
                    </div>
                </div>
            </header>

            <nav class="mb-8">
                <div class="flex border-b border-gray-200">
                    <button class="tab-btn active" data-tab="form">Unggah File</button>
                    <button class="tab-btn" data-tab="gallery">Lihat Histori Anda</button>
                </div>
            </nav>

            <div id="content-container" class="relative overflow-hidden w-full">
                <section id="form-tab" class="tab-content active">
                    <div class="bg-white rounded-2xl shadow p-6">
                        <h2 class="text-xl font-semibold text-red-600 mb-4">Unggah File & deskripsi</h2>
                        <form id="entryForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-2 space-y-3">
                                <div>
                                    <label for="name" class="block text-sm font-medium text-gray-700">Nama</label>
                                    <input type="text" id="name" class="form-input mt-1" placeholder="Contoh: Rakha" required />
                                </div>
                                <div>
                                    <label for="kelas" class="block text-sm font-medium text-gray-700">Judul</label>
                                    <input type="text" id="kelas" class="form-input mt-1" placeholder="Contoh: Kode Php" required />
                                </div>
                                <div>
                                    <label for="desc" class="block text-sm font-medium text-gray-700">Deskripsi / Cerita (opsional)</label>
                                    <textarea id="desc" rows="4" class="form-input mt-1" placeholder="Ceritakan proses atau ide kreatifmu..."></textarea>
                                </div>
                               <div id="dropArea" 
     style="padding: 12px; border: 2px dashed #9ca3af; border-radius: 8px; background-color: #f9fafb; transition: 0.3s; cursor: pointer; text-align: center;">

  <label for="fileInput" style="display:block; font-size:14px; font-weight:500; color:#374151; margin-bottom:6px; cursor:pointer;">
    Klik atau Drag & Drop file ke sini
  </label>

  <input type="file" id="fileInput" multiple style="display:none;" />

  <p style="font-size:12px; color:#6b7280; margin-top:6px;">
    Format: semua file bisa. Maks 100MB disarankan dibawah 30mb
  </p>
</div>
<p style="font-size:12px; color:#374151; margin-top:8px; font-style:italic;">
  *Semua File yang sudah terkirim bersifat permanen.
</p>
<p style="font-size:12px; color:#374151; font-style:italic;">
  *Jika terjadi bug silahkan refresh/tekan f5
</p>
<p style="font-size:12px; color:#374151; margin-top:6px;">
  *Jika ada kendala hubungi 
  <a href="https://wa.me/6289530067456" target="_blank" style="color:#1d4ed8; text-decoration:underline;">
    WhatsApp
  </a>
</p>
<script>
  const dropArea = document.getElementById('dropArea');
  const fileInput = document.getElementById('fileInput');
  const info = dropArea.querySelector("p");

  // drag masuk
  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, e => {
      e.preventDefault();
      e.dataTransfer.dropEffect = "copy";
      dropArea.style.backgroundColor = "#e0f2fe";
      dropArea.style.borderColor = "#3b82f6";
    });
  });

  // drag keluar atau selesai
  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, e => {
      e.preventDefault();
      dropArea.style.backgroundColor = "#f9fafb";
      dropArea.style.borderColor = "#9ca3af";
    });
  });

  // saat file dijatuhkan
  dropArea.addEventListener('drop', e => {
    e.preventDefault();
    const files = e.dataTransfer.files;
    if (files.length > 0 && info) {
      const names = Array.from(files).map(f => f.name).join(", ");
      info.textContent = "File terpilih: " + names + " (masukkan ulang jika ingin mengganti)";
      window.selectedFiles = files;
    }
  });

  // kalau user pilih manual lewat klik (via label → input)
  fileInput.addEventListener('change', () => {
    const files = fileInput.files;
    if (files.length > 0 && info) {
      const names = Array.from(files).map(f => f.name).join(", ");
      info.textContent = "File terpilih: " + names + " (masukkan ulang jika ingin mengganti)";
      window.selectedFiles = files;
    }
  });
</script>
                            </div>
                            
                            <div class="md:col-span-1 flex flex-col justify-between">
                                <div>
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700">Preview kartu</label>
                                        <div id="cardPreview" class="mt-2 border rounded-lg p-3 bg-red-50">
                                            <div class="flex items-center gap-3">
                                                <div id="previewInitial" class="w-12 h-12 rounded bg-white flex items-center justify-center text-red-600 font-bold">A</div>
                                                <div>
                                                    <div id="previewName" class="text-sm font-semibold text-red-700">Nama</div>
                                                    <div id="previewKelas" class="text-xs text-gray-600"></div>
                                                </div>
                                            </div>
                                            <p id="previewDesc" class="text-xs text-gray-700 mt-3">Deskripsi singkat akan muncul di sini...</p>
                                        </div>
                                    </div>
                                    <button type="submit" class="w-full btn-primary">Unggah & Simpan</button>
                                </div>
                               <div class="mt-4">
  <button type="button" id="downloadBtn" class="w-full border border-red-600 text-red-600 py-2 rounded-lg">
    LIHAT UNGGAHAN ORANG LAIN
  </button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('downloadBtn');
    btn.addEventListener('click', () => {
      window.open('https://docs.google.com/spreadsheets/d/1OZnU48cwJUiu53t_3spkmap_LFrFsAnSETj2K4ODMTc/edit?usp=sharing', '_blank');
    });
  });
</script>


                            </div>
                        </form>
                    </div>
                </section>

                <section id="gallery-tab" class="tab-content absolute top-0 left-0 w-full transform transition-transform duration-300 translate-x-full">
                    <div class="bg-white rounded-2xl shadow p-6">
                        <h3 class="text-lg font-semibold text-red-700 mb-4">Histori Pengiriman anda (<span id="entryCount">0</span>)</h3>
                        <p style="font-size:12px; color:#374151; margin-top:8px; font-style:italic;">
  *Semua File yang sudah terkirim bersifat permanen.
</p>

<p style="font-size:12px; color:#374151; margin-top:6px;">
  *Jika ada kendala hubungi 
  <a href="https://wa.me/6289530067456" target="_blank" style="color:#1d4ed8; text-decoration:underline;">
    WhatsApp
  </a>
</p>


                        <div id="galleryContainer">
                            <div id="emptyMessage" class="text-center py-12">Belum ada unggahan. Ajak temanmu untuk simpan file publik disini 🎉</div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- Counter Visitor -->
<div style="width: 100%; text-align: center; margin: 20px 0;">
  <script type="text/javascript" src="https://www.free-counters.org/count/ilbv"></script>
  <br>
  <a href="https://www.acadoo.de/" target="_blank" rel="noopener">acadoo</a>
  <script type="text/javascript" src="https://whomania.com/ctr?id=e73be34504d2d123faee7a71d6a4e2b3c06b56cc"></script>
</div>


            <footer class="mt-10 text-center text-sm text-white">
  © 2025 Situs Kirim File — dibuat untuk Menyimpan File. Tema: Kanutan 🇮🇩 YOHANES ALFARO S
</footer>
<footer class="mt-2 text-center text-sm text-white">
  Versi: 1.6.1
</footer>

        </div>
    </div>

    <script>
document.getElementById("entryForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const scriptUrl = "https://script.google.com/macros/s/AKfycbwZNOMgGwPspOYegaQVIlhL8823ZLCLSlp7WT-T1iZCHDjlu7v1TQO2ba8xy8hey_WT/exec";

  let fileInput = document.getElementById("fileInput");
  let files = window.selectedFiles || document.getElementById("fileInput").files;


  if (files.length === 0) {
    alert("Pilih file dulu ya!");
    return;
  }

  const nama = document.getElementById("name").value;
  const kelas = document.getElementById("kelas").value;
  const deskripsi = document.getElementById("desc").value;

  let uploadedLinks = [];


  for (let i = 0; i < files.length; i++) {
    let file = files[i];

// validasi ukuran 100MB
if (file.size > 100 * 1024 * 1024) {
  alert("File " + file.name + " terlalu besar (maks 100MB).");
  continue;
}


    // ubah file jadi base64
    let base64Data = await new Promise((resolve, reject) => {
      let reader = new FileReader();
      reader.onload = () => resolve(reader.result.split(',')[1]);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });

    // siapkan payload urlencoded
    let payload = new URLSearchParams();
    payload.append("nama", nama);
    payload.append("kelas", kelas);
    payload.append("deskripsi", deskripsi);
    payload.append("file", base64Data);
    payload.append("filename", file.name);
    payload.append("mimeType", file.type);

    try {
      let response = await fetch(scriptUrl, {
        method: "POST",
        body: payload,
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        }
      });

      if (!response.ok) throw new Error("HTTP error " + response.status);
      let result = await response.json();

      if (result.status === "success") {
        uploadedLinks.push(result.link);
        console.log("File " + file.name + " berhasil diupload: " + result.link);
      } else {
        alert("Gagal upload: " + result.message);
        break;
      }
    } catch (error) {
      alert("Gagal mengunggah: " + error.message);
      break;
    }
  }

  if (uploadedLinks.length > 0) {
    let entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.push({
      nama: nama,
      kelas: kelas,
      deskripsi: deskripsi,
      files: uploadedLinks,
      time: new Date().toLocaleString("id-ID")
    });
    localStorage.setItem("entries", JSON.stringify(entries));
    updateGallery();
  }

  alert("Semua file berhasil diupload.");
});
</script>



</body>
</html>