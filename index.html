<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kirim File ke Server</title>
    <link rel="stylesheet" href="style.css" />
    <script src="script.js" defer></script>

    <!-- Favicon / Logo -->
    <link rel="icon" type="image/png" href="https://png.pngtree.com/png-clipart/20230409/original/pngtree-free-delivery-truck-logo-design-png-image_9037662.png" />
</head>

<body>
    <!-- Splash Intro -->
    <div id="splashIntro" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fff;display:flex;justify-content:center;align-items:center;flex-direction: column;z-index:9999; transition: opacity 0.5s ease;">
  <img src="https://png.pngtree.com/png-clipart/20230409/original/pngtree-free-delivery-truck-logo-design-png-image_9037662.png" alt="Logo Intro" style="width:150px; height:150px; object-fit:contain;" />
  <div id="refreshMessage" style="margin-top: 1rem; color: red; font-weight: bold; display: none; text-align: center;">
    Jika halaman tersendat, silakan <button onclick="location.reload()" style="color: blue; text-decoration: underline; background:none; border:none; cursor:pointer; font-weight: normal;">refresh</button> halaman ini.
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const splash = document.getElementById('splashIntro');
    const refreshMsg = document.getElementById('refreshMessage');

    if (sessionStorage.getItem('introShown')) {
      splash.style.display = 'none';
    } else {
      setTimeout(() => {
        splash.classList.add('fade-out');
        splash.style.opacity = '0';

        splash.addEventListener('transitionend', () => {
          splash.style.display = 'none';
        });

        sessionStorage.setItem('introShown', 'true');
      }, 2000);

      // Jika splash masih tampil setelah 5 detik, tampilkan pesan refresh
      setTimeout(() => {
        if (splash.style.display !== 'none') {
          refreshMsg.style.display = 'block';
        }
      }, 5000);
    }
  });
</script>

<style>
  #splashIntro.fade-out {
    opacity: 0;
    transition: opacity 0.5s ease;
  }
</style>

    <div id="app" class="min-h-screen p-6">
        <div class="max-w-5xl mx-auto">
            <header class="header-responsive mb-6">
                <div class="header-slideshow-container">
                    <img src="https://sumbermulyo.bantulkab.go.id/assets/files/artikel/sedang_1692938810WhatsAppImage20230825at08.46.24.jpeg" alt="Gambar Daur Ulang 1" class="slideshow-image" />
                    <img src="https://media.suara.com/pictures/970x544/2019/11/19/12445-kabupaten-bantul-di-yogyakarta-suarayulita-futty.jpg" alt="Gambar Daur Ulang 2" class="slideshow-image" />
                    <img src="https://balistarisland.com/wp-content/uploads/2016/09/yogyakartacity1.jpg" alt="Gambar Daur Ulang 3" class="slideshow-image" />
                    <img src="https://3.bp.blogspot.com/-icZreC9Ks_g/XHy43zoCO5I/AAAAAAAAF4Y/PCifEyANKqcg4nCpwaEruhiHEWZ3KmLDwCLcBGAs/s1600/a8.jpg" alt="Depan SMKN 1 Bantul" class="slideshow-image" />
                </div>

                <div class="header-content">
                    <img src="https://png.pngtree.com/png-clipart/20230409/original/pngtree-free-delivery-truck-logo-design-png-image_9037662.png" alt="Logo Sekolah" class="w-20 h-20 object-contain rounded-lg shadow-md bg-white p-2" />
                    <div class="text-white">
                        <h1 class="text-3xl font-extrabold text-red-700">Kirim Segala Jenis File Di situs Ini</h1>
                        <p class="text-sm text-gray-200">Yhns 01 Production — Kirim file yang bisa di download disini!</p>
                    </div>
                </div>
            </header>

            <nav class="mb-8">
                <div class="flex border-b border-gray-200">
                    <button class="tab-btn active" data-tab="form">Unggah File</button>
                    <button class="tab-btn" data-tab="gallery">Lihat Histori Anda</button>
                </div>
            </nav>

            <div id="content-container" class="relative overflow-hidden w-full">
                <section id="form-tab" class="tab-content active">
                    <div class="bg-white rounded-2xl shadow p-6">
                        <h2 class="text-xl font-semibold text-red-600 mb-4">Unggah File & deskripsi</h2>
                        <form id="entryForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-2 space-y-3">
                                <div>
                                    <label for="name" class="block text-sm font-medium text-gray-700">Nama</label>
                                    <input type="text" id="name" class="form-input mt-1" placeholder="Contoh: Rakha" required />
                                </div>
                                <div>
                                    <label for="kelas" class="block text-sm font-medium text-gray-700">Judul</label>
                                    <input type="text" id="kelas" class="form-input mt-1" placeholder="Contoh: Kode Php" required />
                                </div>
                                <div>
                                    <label for="desc" class="block text-sm font-medium text-gray-700">Deskripsi / Cerita (opsional)</label>
                                    <textarea id="desc" rows="4" class="form-input mt-1" placeholder="Ceritakan proses atau ide kreatifmu..."></textarea>
                                </div>
                               <div id="dropArea" 
     style="padding: 12px; border: 2px dashed #9ca3af; border-radius: 8px; background-color: #f9fafb; transition: 0.3s; cursor: pointer; text-align: center;">

  <label for="fileInput" style="display:block; font-size:14px; font-weight:500; color:#374151; margin-bottom:6px;">
    Klik atau Drag & Drop file ke sini
  </label>

  <input type="file" id="fileInput" accept="image/*,video/*" multiple
         style="display:none;" />

  <p style="font-size:12px; color:#6b7280; margin-top:6px;">
    Format: semua file bisa. Maks 100MB
  </p>
</div>

<script>
  const dropArea = document.getElementById('dropArea');
  const fileInput = document.getElementById('fileInput');

  // klik area → buka file picker
  dropArea.addEventListener('click', () => fileInput.click());

  // drag masuk
  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, e => {
      e.preventDefault();
      dropArea.style.backgroundColor = "#e0f2fe";
      dropArea.style.borderColor = "#3b82f6";
    });
  });

  // drag keluar atau drop selesai
  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, e => {
      e.preventDefault();
      dropArea.style.backgroundColor = "#f9fafb";
      dropArea.style.borderColor = "#9ca3af";
    });
  });

  // saat file dijatuhkan
  dropArea.addEventListener('drop', e => {
    e.preventDefault();
    if (e.dataTransfer.files.length) {
      fileInput.files = e.dataTransfer.files;

      // tampilkan nama file agar user yakin
      let names = [...fileInput.files].map(f => f.name).join(", ");
      dropArea.querySelector("p").textContent = "File terpilih: " + names + ", masukkan ulang jika ingin mengganti";
    }
  });

  // kalau user pilih manual lewat klik
  fileInput.addEventListener('change', () => {
    let names = [...fileInput.files].map(f => f.name).join(", ");
    dropArea.querySelector("p").textContent = "File terpilih: " + names + ", masukkan ulang jika ingin mengganti";
  });
</script>



                            </div>
                            <div class="md:col-span-1 flex flex-col justify-between">
                                <div>
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700">Preview kartu</label>
                                        <div id="cardPreview" class="mt-2 border rounded-lg p-3 bg-red-50">
                                            <div class="flex items-center gap-3">
                                                <div id="previewInitial" class="w-12 h-12 rounded bg-white flex items-center justify-center text-red-600 font-bold">A</div>
                                                <div>
                                                    <div id="previewName" class="text-sm font-semibold text-red-700">Nama</div>
                                                    <div id="previewKelas" class="text-xs text-gray-600"></div>
                                                </div>
                                            </div>
                                            <p id="previewDesc" class="text-xs text-gray-700 mt-3">Deskripsi singkat akan muncul di sini...</p>
                                        </div>
                                    </div>
                                    <button type="submit" class="w-full btn-primary">Unggah & Simpan</button>
                                </div>
                               <div class="mt-4">
  <button type="button" id="downloadBtn" class="w-full border border-red-600 text-red-600 py-2 rounded-lg">
    LIHAT UNGGAHAN PESERTA LAIN
  </button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('downloadBtn');
    btn.addEventListener('click', () => {
      window.open('https://docs.google.com/spreadsheets/d/1uwXXhTkv3mQEK-Uu66x_kXr-kRyF2Blc97DOPagX4Aw/edit?usp=sharing', '_blank');
    });
  });
</script>


                            </div>
                        </form>
                    </div>
                </section>

                <section id="gallery-tab" class="tab-content absolute top-0 left-0 w-full transform transition-transform duration-300 translate-x-full">
                    <div class="bg-white rounded-2xl shadow p-6">
                        <h3 class="text-lg font-semibold text-red-700 mb-4">Galeri Karya (<span id="entryCount">0</span>)</h3>
                        <div id="galleryContainer">
                            <div id="emptyMessage" class="text-center py-12">Belum ada unggahan. Ajak temanmu ikut! 🎉</div>
                        </div>
                    </div>
                </section>
            </div>

            <footer class="mt-10 text-center text-sm text-gray-600">© 2025 Situs Kirim File — dibuat untuk Menyimpan File. Tema: Kanutan 🇮🇩 YOHANES ALFARO S</footer>
             <footer class="mt-10 text-center text-sm text-gray-600">Versi: 1.1</footer>
        </div>
    </div>

    <script>
document.getElementById("entryForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const scriptUrl = "https://script.google.com/macros/s/AKfycbzk2N1RZEL99VKfsbMHLQuHhhN0EB2GEC6wN0bMk3S5g7wi2cCmVMOcCuAyP5Fxh90u/exec";

  let fileInput = document.getElementById("fileInput");
  let files = fileInput.files;

  if (files.length === 0) {
    alert("Pilih file dulu ya!");
    return;
  }

  const nama = document.getElementById("name").value;
  const kelas = document.getElementById("kelas").value;
  const deskripsi = document.getElementById("desc").value;

  let uploadedLinks = []; // simpan link dari server

  for (let i = 0; i < files.length; i++) {
    let file = files[i];

    let base64Data = await new Promise((resolve, reject) => {
      let reader = new FileReader();
      reader.onload = () => resolve(reader.result.split(',')[1]);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });

    let formData = new FormData();
    formData.append("nama", nama);
    formData.append("kelas", kelas);
    formData.append("deskripsi", deskripsi);
    formData.append("file", base64Data);
    formData.append("filename", file.name);
    formData.append("mimeType", file.type);

    try {
      let response = await fetch(scriptUrl, {
        method: "POST",
        body: formData
      });

      if (!response.ok) throw new Error("HTTP error " + response.status);
      let result = await response.json();

      if (result.status === "success") {
        uploadedLinks.push(result.link);
        console.log("File " + file.name + " berhasil diupload: " + result.link);
      } else {
        alert("Gagal upload: " + result.message);
        break;
      }
    } catch (error) {
      alert("Gagal mengunggah: " + error.message);
      break;
    }
  }

  // simpan ke localStorage sebagai histori
  if (uploadedLinks.length > 0) {
    let entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.push({
      nama: nama,
      kelas: kelas,
      deskripsi: deskripsi,
      files: uploadedLinks,   // simpan array link file
      time: new Date().toLocaleString("id-ID")
    });
    localStorage.setItem("entries", JSON.stringify(entries));
    updateGallery(); // refresh tampilan
  }

  alert("Semua file berhasil diupload.");
});
</script>
<script>
function updateGallery() {
  let container = document.getElementById("galleryContainer");
  let entries = JSON.parse(localStorage.getItem("entries")) || [];

  if (entries.length === 0) {
    container.innerHTML = '<div id="emptyMessage" class="text-center py-12">Belum ada unggahan. Ajak temanmu ikut! 🎉</div>';
  } else {
    container.innerHTML = "";
    entries.forEach(entry => {
      let div = document.createElement("div");
      div.className = "border rounded-lg p-4 mb-3 bg-gray-50";
      div.innerHTML = `
        <h4 class="font-bold text-red-700">${entry.nama} — ${entry.kelas}</h4>
        <p class="text-sm text-gray-600">${entry.deskripsi || "(tanpa deskripsi)"}</p>
        <div class="mt-2 space-y-1">
          ${entry.files.map(link => `<a href="${link}" target="_blank" class="text-blue-600 underline text-sm">${link}</a>`).join("<br>")}
        </div>
        <div class="text-xs text-gray-500 mt-2">${entry.time}</div>
      `;
      container.appendChild(div);
    });
  }

  // update jumlah
  document.getElementById("entryCount").textContent = entries.length;
}

// load saat halaman dibuka
document.addEventListener("DOMContentLoaded", updateGallery);
</script>

</body>
</html>